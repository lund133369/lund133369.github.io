## Vulnerability Assessment {-}

### SQL Truncate {-}

**SQL Truncate** es una vulnerabilidad que viene del echo que un input de usuario no esta sanitizado en terminos de *length* y que 
la columna corespondiente en el SQL esta definida con un tamaño. Esta vulnerabilidad permite al atacante modificar el comportamiento
de la peticion sql. En un caso como este, y mas precisamente en el panel de registo, en vez de crear un nuevo usuario, podriamos como
atacante cambiar la contraseña de este mismo usuario superando el tamaño definido en SQL.

Si el tamaño definido por la columna `email` es `varchar(16)`, si como atacante ponemos el email `admin@book.htb` con espacios al final mas
cualquier carater y que en este caso excede este tamaño de 16, podriamos cambiar su contraseña.

Si en burpsuite creamos un usuario con la data

```bash
name=admin&email=admin@book.htb&password=admin123
```

la respuesta al lado del servidor nos dice que el usuario ya existe. pero si excedemos el tamaño definido en la columna de la tabla SQL con
una peticion 

```bash
name=admin&email=admin@book.htb               .&password=admin123
```

la respuesta es un 302 Found.

Si nos connectamos ahora como `admin` y con la contraseña `admin123`, podemos entrar como el usuario admin.
En este caso vamos directamente a la url `http://10.10.10.176/admin` para entrar en el panel de administracion de la web.

Aqui Vemos que podemos ver los usuarios registrados, los mensajes enviados por los usuarios los feedbacks y la collections.

Aqui nos llama la atencion el `/admin/collections.php` porque hay un link a un pdf de la collectiones de la web.
Si nos acordamos bien, el contenido es muy parecido a las entradas que teniamos como usuario normal a la hora de crear una nueva
collection.

Si nos connectamos en una nueva pagina web al panel normal (el donde podiamos crear una nueva collection) y creamos una nuevamente
con

```bash
title: test
author: test
un fichero txt en el file upload
```

Podemos ver que esta collection a sido creada y aparece en el pdf de la collections de panel de administracion y nos reporta la data title y author.

Buscamos en internet si existe un html 2 pdf exploit.

### html2pdf exploit {-}

Buscamos por `html 2 pdf exploit`, no vemos gran cosa. Cambiamos la busqueda por vulnerabilidades conocidas como RCE LFI XSS
y encontramos un un [Local File Read via XSS in Dynamically Generated PDF](https://blog.noob.ninja/local-file-read-via-xss-in-dynamically-generated-pdf/)

Aqui vemos que con la inclusion de un `<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open("GET","file:///etc/passwd");x.send();</script>`
podriamos ejecutar un LFI.

Si lo ponemos en el input Title y author, podemos ver el `/etc/passwd` de la maquina en el pdf generado.

En este caso vemos que hay un usuario `Reader` que tiene una bash. Miramos si podemos leer su `id_rsa`

`<script>x=new XMLHttpRequest;x.onload=function(){document.write(this.responseText)};x.open("GET","file:///home/reader/.ssh/id_rsa");x.send();</script>`

Ya podemos ver su llave privada y connectarnos por ssh.
